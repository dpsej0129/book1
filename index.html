<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>책 요약 & 리뷰 사이트</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 700px;
      margin: 20px auto;
      padding: 0 10px;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    input, select {
      padding: 10px;
      margin: 10px 0;
      width: 100%;
      font-size: 16px;
    }
    button {
      padding: 10px;
      background-color: #007bff;
      border: none;
      color: white;
      font-size: 16px;
      cursor: pointer;
      margin-bottom: 10px;
    }
    button:hover {
      background-color: #0056b3;
    }
    ul {
      list-style-type: none;
      padding: 0;
    }
    li {
      background-color: #f4f4f4;
      margin: 10px 0;
      padding: 15px;
      border-radius: 8px;
    }
    .highlight {
      background-color: yellow;
    }
    #recent-books {
      margin-top: 30px;
      border-top: 1px solid #ccc;
      padding-top: 10px;
    }
  </style>
</head>
<body>
  <h1>📚 책 요약 & 리뷰</h1>

  <input type="text" id="searchInput" placeholder="책 제목이나 내용을 검색하세요" />

  <select id="categoryFilter">
    <option value="전체">전체</option>
    <option value="자기계발">자기계발</option>
    <option value="심리학">심리학</option>
    <option value="역사">역사</option>
  </select>

  <button id="showAllBtn">모든 책 보기</button>

  <ul id="bookList"></ul>

  <div id="recent-books">
    <h3>📌 최근 본 책</h3>
    <ul id="recentList"></ul>
  </div>

  <script>
    const bookData = [
      {
        title: "미라클 모닝",
        summary: "기적 같은 아침 습관으로 인생을 바꾸는 방법",
        category: "자기계발",
        url: "book1.html"
      },
      {
        title: "그릿",
        summary: "끈기의 힘과 성공의 비밀",
        category: "심리학",
        url: "book2.html"
      },
      {
        title: "사피엔스",
        summary: "인간의 역사와 문명의 기원",
        category: "역사",
        url: "book3.html"
      }
    ];

    const bookList = document.getElementById("bookList");
    const searchInput = document.getElementById("searchInput");
    const categoryFilter = document.getElementById("categoryFilter");
    const showAllBtn = document.getElementById("showAllBtn");
    const recentList = document.getElementById("recentList");

    let showAll = false;

    function highlightText(text, keyword) {
      if (!keyword) return text;
      return text.replace(new RegExp(`(${keyword})`, "gi"), '<span class="highlight">$1</span>');
    }

    function displayBooks(query = "", category = "전체") {
      bookList.innerHTML = "";

      const filteredBooks = bookData.filter(book => {
        const matchQuery = book.title.includes(query) || book.summary.includes(query);
        const matchCategory = category === "전체" || book.category === category;
        return matchQuery && matchCategory;
      });

      const booksToShow = showAll ? filteredBooks : filteredBooks.slice(0, 0);

      booksToShow.forEach(book => {
        const highlightedTitle = highlightText(book.title, query);
        const highlightedSummary = highlightText(book.summary, query);

        bookList.innerHTML += `
          <li>
            <a href="${book.url}" class="book-link" data-title="${book.title}" data-summary="${book.summary}" data-url="${book.url}" style="color: black; text-decoration: none;">
              ${highlightedTitle}
            </a> - ${highlightedSummary}
          </li>
        `;
      });

      if (showAll) {
        showAllBtn.style.display = "none";
      }
    }

    function saveRecentBook(book) {
      let recent = JSON.parse(localStorage.getItem("recentBooks")) || [];
      recent = recent.filter(b => b.title !== book.title); // 중복 제거
      recent.unshift(book); // 가장 앞에 추가
      if (recent.length > 5) recent.pop(); // 최대 5개
      localStorage.setItem("recentBooks", JSON.stringify(recent));
      loadRecentBooks();
    }

    function loadRecentBooks() {
      const recent = JSON.parse(localStorage.getItem("recentBooks")) || [];
      recentList.innerHTML = "";
      recent.forEach(book => {
        recentList.innerHTML += `
          <li><a href="${book.url}" style="text-decoration:none; color:black;">${book.title}</a></li>
        `;
      });
    }

    // 이벤트 연결
    searchInput.addEventListener("input", () => {
      showAll = true;
      displayBooks(searchInput.value, categoryFilter.value);
    });

    categoryFilter.addEventListener("change", () => {
      showAll = true;
      displayBooks(searchInput.value, categoryFilter.value);
    });

    showAllBtn.addEventListener("click", () => {
      showAll = true;
      displayBooks(searchInput.value, categoryFilter.value);
    });

    bookList.addEventListener("click", (e) => {
      if (e.target.closest(".book-link")) {
        const link = e.target.closest(".book-link");
        const title = link.dataset.title;
        const summary = link.dataset.summary;
        const url = link.dataset.url;
        saveRecentBook({ title, summary, url });
      }
    });

    // 초기 실행
    displayBooks();
    loadRecentBooks();
  </script>
</body>
</html>
