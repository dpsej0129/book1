<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>책 요약 & 리뷰</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 30px auto;
      padding: 20px;
      background-color: #fefefe;
    }
    h1 {
      text-align: center;
    }
    .search-bar {
      display: flex;
      margin-bottom: 10px;
    }
    input, select {
      flex: 1;
      padding: 8px;
      margin-right: 8px;
    }
    button {
      padding: 8px 12px;
    }
    .book-list {
      list-style: none;
      padding: 0;
    }
    .book-item {
      padding: 10px;
      border-bottom: 1px solid #ccc;
    }
    .highlight {
      background-color: yellow;
    }
    #all-books-btn {
      margin-top: 10px;
      display: block;
    }
    .section-title {
      margin-top: 30px;
      font-size: 1.2em;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <h1>📚 책 요약 & 리뷰</h1>

  <div class="search-bar">
    <input type="text" id="searchInput" placeholder="책 제목 검색" />
    <select id="categoryFilter">
      <option value="">카테고리 전체</option>
      <option value="자기계발">자기계발</option>
      <option value="심리">심리</option>
      <option value="역사">역사</option>
    </select>
    <button onclick="searchBooks()">검색</button>
  </div>

  <button id="all-books-btn" onclick="showAllBooks()">모든 책 보기</button>

  <ul class="book-list" id="bookList"></ul>

  <div class="section-title">📖 최근 본 책</div>
  <ul class="book-list" id="recentBooks"></ul>

  <script>
    const books = [
      { title: "미라클 모닝", category: "자기계발", link: "book1.html" },
      { title: "그릿", category: "심리", link: "book2.html" },
      { title: "사피엔스", category: "역사", link: "book3.html" }
    ];

    const bookListEl = document.getElementById("bookList");
    const searchInput = document.getElementById("searchInput");
    const categoryFilter = document.getElementById("categoryFilter");
    const allBooksBtn = document.getElementById("all-books-btn");

    function highlight(text, keyword) {
      if (!keyword) return text;
      return text.replace(new RegExp(`(${keyword})`, "gi"), "<span class='highlight'>$1</span>");
    }

    function renderBooks(filteredBooks, keyword = "") {
      bookListEl.innerHTML = "";
      filteredBooks.forEach(book => {
        const li = document.createElement("li");
        li.className = "book-item";
        li.innerHTML = `<a href="${book.link}" onclick="addRecent('${book.title}', '${book.link}')">${highlight(book.title, keyword)}</a> - ${book.category}`;
        bookListEl.appendChild(li);
      });
    }

    function searchBooks() {
      const keyword = searchInput.value.trim().toLowerCase();
      const category = categoryFilter.value;

      const filtered = books.filter(book => {
        const matchTitle = book.title.toLowerCase().includes(keyword);
        const matchCategory = category === "" || book.category === category;
        return matchTitle && matchCategory;
      });

      renderBooks(filtered, keyword);
      allBooksBtn.style.display = "none";
    }

    function showAllBooks() {
      renderBooks(books);
      allBooksBtn.style.display = "none";
    }

    function addRecent(title, link) {
      let recent = JSON.parse(localStorage.getItem("recentBooks") || "[]");
      recent = recent.filter(book => book.title !== title);
      recent.unshift({ title, link });
      if (recent.length > 5) recent.pop();
      localStorage.setItem("recentBooks", JSON.stringify(recent));
    }

    function loadRecentBooks() {
      const recent = JSON.parse(localStorage.getItem("recentBooks") || "[]");
      const recentEl = document.getElementById("recentBooks");
      recentEl.innerHTML = "";
      recent.forEach(book => {
        const li = document.createElement("li");
        li.className = "book-item";
        li.innerHTML = `<a href="${book.link}">${book.title}</a>`;
        recentEl.appendChild(li);
      });
    }

    window.onload = () => {
      loadRecentBooks();
    };
  </script>

</body>
</html>
